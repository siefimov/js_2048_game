class t{static STATUS={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=t.STATUS.IDLE,this.initialState=e,this.state=e.map(t=>[...t]),this.score=0}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.STATUS.PLAYING,this.state=this.initialState.map(t=>[...t]),this.addNewNumber(),this.addNewNumber()}restart(){this.status=t.STATUS.IDLE,this.state=this.initialState.map(t=>[...t]),this.score=0}addNewNumber(){let t=this.getEmptyPosition();if(0===t.length)return;let e=Math.floor(Math.random()*t.length),[s,i]=t[e];this.state[s][i]=.9>Math.random()?2:4}getEmptyPosition(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);return t}moveLeft(){if(this.getStatus()===t.STATUS.PLAYING){let t=this.state.length,e=this.getState(),s=!1;for(let i=0;i<t;i++){let a=[],l=Array(t).fill(!1);for(let s=0;s<t;s++)0!==e[i][s]&&a.push(e[i][s]);for(let t=0;t<a.length-1;t++)a[t]!==a[t+1]||l[t]||l[t+1]||(a[t]*=2,this.score+=a[t],a.splice(t+1,1),l[t]=!0);for(;a.length<t;)a.push(0);for(let l=0;l<t;l++)e[i][l]!==a[l]&&(e[i][l]=a[l],s=!0)}this.handleMove(s)}}moveRight(){if(this.getStatus()===t.STATUS.PLAYING){let t=this.state.length,e=this.getState(),s=!1;for(let i=0;i<t;i++){let a=[];for(let s=0;s<t;s++)0!==e[i][s]&&a.push(e[i][s]);let l=Array(a.length).fill(!1);for(let t=a.length-1;t>0;t--)a[t]!==a[t-1]||l[t]||l[t-1]||(a[t]*=2,this.score+=a[t],a.splice(t-1,1),l.splice(t-1,1),l[t-1]=!0);for(;a.length<t;)a.unshift(0);for(let l=0;l<t;l++)e[i][l]!==a[l]&&(e[i][l]=a[l],s=!0)}this.handleMove(s)}}moveUp(){if(this.getStatus()===t.STATUS.PLAYING){let t=this.state.length,e=this.getState(),s=!1;for(let i=0;i<t;i++){let a=[];for(let s=0;s<=t-1;s++)0!==e[s][i]&&a.push(e[s][i]);for(let t=0;t<a.length;t++)a[t]===a[t+1]&&(a[t]*=2,this.score+=a[t],a.splice(t+1,1));for(;a.length<t;)a.push(0);for(let l=0;l<t;l++)e[l][i]!==a[l]&&(e[l][i]=a[l],s=!0)}this.handleMove(s)}}moveDown(){if(this.getStatus()===t.STATUS.PLAYING){let t=this.state.length,e=this.getState(),s=!1;for(let i=0;i<t;i++){let a=[];for(let s=0;s<=t-1;s++)0!==e[s][i]&&a.push(e[s][i]);let l=Array(a.length).fill(!1);for(let t=a.length-1;t>0;t--)a[t]!==a[t-1]||l[t]||l[t-1]||(a[t]*=2,this.score+=a[t],a.splice(t-1,1),l.splice(t-1,1),l[t-1]=!0);for(;a.length<t;)a.unshift(0);for(let l=0;l<t;l++)e[l][i]!==a[l]&&(e[l][i]=a[l],s=!0)}this.handleMove(s)}}handleMove(e){e&&(this.addNewNumber(),this.checkWin()&&(this.status=t.STATUS.WIN),this.checkLose()&&(this.status=t.STATUS.LOSE))}checkWin(){return this.state.some(t=>t.includes(2048))}checkLose(){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length;e++)if(0===this.state[t][e]||t>0&&this.state[t][e]===this.state[t-1][e]||t<this.state.length-1&&this.state[t][e]===this.state[t+1][e]||e>0&&this.state[t][e]===this.state[t][e-1]||e<this.state[t].lenth-1&&this.state[t][e]===this.state[t][e+1])return!1;return!0}}const e=new t,s=document.querySelector(".start"),i=document.querySelector(".game-score"),a=document.querySelectorAll("tr"),l=document.querySelector(".message-lose"),r=document.querySelector(".message-win"),h=document.querySelector(".message-start"),o=()=>{let t=e.getState();a.forEach((e,s)=>{for(let i of e.cells){i.textContent="",i.className="field-cell";let e=i.cellIndex,a=t[s][e];0!==a&&(i.textContent=a,i.classList.add(`${i.className}--${a}`))}})},n=()=>{l.classList.add("hidden"),r.classList.add("hidden"),h.classList.add("hidden"),"win"===e.getStatus()?r.classList.remove("hidden"):"lose"===e.getStatus()?l.classList.remove("hidden"):"idle"===e.getStatus()&&h.classList.remove("hidden")},c=()=>{i.textContent=e.getScore()};let d=!0;s.addEventListener("click",()=>{"Start"===s.textContent&&e.start(),"Restart"===s.textContent&&(e.restart(),s.textContent="Start",s.classList.remove("restart"),s.classList.add("start"),c()),o(),n(),d=!0}),document.addEventListener("keydown",t=>{if("idle"!==e.getStatus()){switch(t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}d&&(s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart"),d=!1),n(),o(),c()}});
//# sourceMappingURL=index.01cf0abc.js.map
